<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ú–æ–Ω–∏—Ç–æ—Ä –±–∞–ª–∞–Ω—Å–æ–≤</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,.1);
      border-radius: 0.75rem;
    }
    .table td, .table th {
      vertical-align: middle;
    }
  </style>
  <script>
    // –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ "n —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥"
    setInterval(() => location.reload(), 60000);
    function timeago() {
      document.querySelectorAll('[data-updated]').forEach(el => {
        const updated = new Date(el.dataset.updated);
        const now = new Date();
        const seconds = Math.floor((now - updated) / 1000);
        let txt = seconds < 60 ? `${seconds} —Å–µ–∫ –Ω–∞–∑–∞–¥` :
                  seconds < 3600 ? `${Math.floor(seconds/60)} –º–∏–Ω –Ω–∞–∑–∞–¥` :
                  `${Math.floor(seconds/3600)} —á –Ω–∞–∑–∞–¥`;
        el.textContent = txt;
      });
    }
    window.onload = timeago;
  </script>
</head>
<body>
  <div class="container my-4">
    <h1 class="mb-4 text-center">üìä –ú–æ–Ω–∏—Ç–æ—Ä –±–∞–ª–∞–Ω—Å–æ–≤</h1>
    <div class="card p-4">
      <table class="table table-hover table-bordered align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
            <th>–ê–∫–∫–∞—É–Ω—Ç</th>
            <th>–ë–∞–ª–∞–Ω—Å, ‚ÇΩ</th>
            <th>–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.source }}</td>
            <td>{{ r.account }}</td>
            <td><strong>{{ '%.2f'|format(r.value) }}</strong></td>
            <td data-updated="{{ (r.updated_at + timedelta(hours=3)).isoformat() }}"></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="text-end text-muted small">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫</div>
    </div>
  </div>
</body>
</html>
